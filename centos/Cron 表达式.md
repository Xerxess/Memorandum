<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=3 orderedList=false} -->

<!-- code_chunk_output -->

- [Cron 表达式](#cron-表达式)
  - [5位（Linux crontab）](#5位linux-crontab)
  - [6/7位（Quartz/Spring）](#67位quartzspring)
  - [特殊字符说明](#特殊字符说明)
  - [常用示例](#常用示例)
  - [特殊字符串（crontab）](#特殊字符串crontab)
  - [CentOS 使用要点](#centos-使用要点)
  - [排错建议](#排错建议)

<!-- /code_chunk_output -->

# Cron 表达式

下文将 5 位（Linux 系统 crontab）与 6/7 位（Quartz/Spring 等）格式分开说明，并给出常用示例与排错要点。

## 5位（Linux crontab）

字段顺序：`分钟 分钟(0-59)`、`小时(0-23)`、`日(1-31)`、`月(1-12 或 JAN-DEC)`、`星期(0-7 或 SUN-SAT)`。

说明：标准 Linux crontab 只支持 `* , - /` 这四种符号，不支持 `? L W #`。

| 位置 | 字段 | 取值范围 | 允许符号 |
|---|---|---|---|
| 1 | 分钟 | 0-59 | `* , - /` |
| 2 | 小时 | 0-23 | `* , - /` |
| 3 | 日 | 1-31 | `* , - /` |
| 4 | 月 | 1-12 或 JAN-DEC | `* , - /` |
| 5 | 星期 | 0-7 或 SUN-SAT | `* , - /` |

提示：星期的周日可用 `0` 或 `7` 表示；`月`、`星期`支持英文缩写（如 `JAN`、`MON`）。

## 6/7位（Quartz/Spring）

字段顺序：`秒 分 时 日 月 星期 [年]`。其中 `[年]` 可选。

说明：Quartz/Spring 扩展支持 `? L W #`，并要求“日(day-of-month)”与“星期(day-of-week)”二者必须有一个为 `?`。

| 位置 | 字段 | 取值范围 | 允许符号 |
|---|---|---|---|
| 1 | 秒 | 0-59 | `* , - /` |
| 2 | 分 | 0-59 | `* , - /` |
| 3 | 时 | 0-23 | `* , - /` |
| 4 | 日 | 1-31 | `* , - / ? L W` |
| 5 | 月 | 1-12 或 JAN-DEC | `* , - /` |
| 6 | 星期 | 1-7 或 SUN-SAT | `* , - / ? L #` |
| 7 | 年(可选) | 1970-2099 | `* , - /` |

> 常见框架：Spring/Quartz、部分 Node/K8s 定时器等。

## 特殊字符说明

| 符号 | 含义 | Linux crontab | Quartz/Spring | 示例 |
|---|---|---|---|---|
| `*` | 任意/所有取值 | 支持 | 支持 | `* * * * *`（每分钟；5位）/ `* * * * * ?`（每秒；6位） |
| `,` | 列表（多个离散值） | 支持 | 支持 | `0 14,16,18 * * *`（14/16/18 点） |
| `-` | 范围 | 支持 | 支持 | `0 9-17 * * 1-5`（工作日 9–17 点整点） |
| `/` | 步长 | 支持 | 支持 | `*/5 * * * *`（每 5 分钟）；`*/10 * * * * ?`（每 10 秒） |
| `?` | 不指定（在“日/星期”二选一） | 不支持 | 支持 | `0 0 0 ? * MON`（每周一 0 点） |
| `L` | 最后（Last） | 不支持 | 支持 | `0 0 0 L * ?`（每月最后一天）/ `0 0 10 ? * 6L`（每月最后一个周五 10 点） |
| `W` | 最近工作日（Weekday） | 不支持 | 支持 | `0 0 9 15W * ?`（每月 15 号最近的工作日 9 点） |
| `#` | 第 N 个星期 X | 不支持 | 支持 | `0 0 14 ? * 4#3`（每月第 3 个周三 14 点） |

## 常用示例

以下示例同时给出 5 位（系统 crontab）与 6 位（Quartz/Spring）写法：

- 每分钟（5位）：`* * * * *`
- 每 5 分钟（5位）：`*/5 * * * *`
- 每小时的第 0 分（5位）：`0 * * * *`
- 每天 02:00（5位）：`0 2 * * *`
- 每周日 02:00（5位）：`0 2 * * 0`（或 `SUN`）
- 每月 1 日 02:00（5位）：`0 2 1 * *`
- 每天 10:15（5位）：`15 10 * * *`
- 工作日 09:00（5位）：`0 9 * * 1-5`
- 周三/周五 00:00（5位）：`0 0 * * 3,5`

- 每秒（6位）：`* * * * * ?`
- 每 5 秒（6位）：`*/5 * * * * ?`
- 每分钟第 0 秒（6位）：`0 * * * * ?`
- 每 5 分钟第 0 秒（6位）：`0 */5 * * * ?`
- 每天 00:00:00（6位）：`0 0 0 * * ?`
- 每周一 00:00（6位）：`0 0 0 ? * MON`
- 每月 1 日 00:00（6位）：`0 0 0 1 * ?`
- 每年 1 月 1 日 00:00（6位）：`0 0 0 1 1 ?`
- 每月最后一个周五 10:00（6位）：`0 0 10 ? * 6L`
- 每月第 3 个周三 14:00（6位）：`0 0 14 ? * 4#3`
- 09–17 点整点（6位）：`0 0 9-17 * * ?`
- 14:00–14:55 每 5 分钟（6位）：`0 0/5 14 * * ?`

## 特殊字符串（crontab）

Linux crontab 还支持下列“宏”写法（等价于常见表达式）：

- `@reboot`：开机/重启后运行一次
- `@hourly`：整点（等价 `0 * * * *`）
- `@daily`：每天（等价 `0 0 * * *`）
- `@weekly`：每周（等价 `0 0 * * 0`）
- `@monthly`：每月（等价 `0 0 1 * *`）
- `@yearly` / `@annually`：每年（等价 `0 0 1 1 *`）

## CentOS 使用要点

- 编辑/查看：`crontab -e` / `crontab -l`
- 服务管理：`systemctl status crond`、`systemctl start crond`、`systemctl enable crond`
- 日志查看：`grep CRON /var/log/cron`，或 `journalctl -u crond`
- 环境变量：在 crontab 顶部可设置 `SHELL=/bin/bash`、`PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin`、`HOME=/root` 等；命令请写绝对路径
- 用户与系统级：
  - 用户 crontab：`crontab -e`（5 位：`分 时 日 月 周 命令`）
  - 系统文件：`/etc/crontab`、`/etc/cron.d/*`（含“用户”列：`分 时 日 月 周 用户 命令`）
- 输出与排错：为捕获输出，建议在条目尾部追加重定向：`>> /var/log/myjob.log 2>&1`
- 时区：Cron 默认使用系统时区；跨时区部署请在应用层统一时间或使用 UTC

## 排错建议

- 命令路径不完整：在表达式中使用绝对路径，或设置 `PATH`
- 权限问题：可执行位与文件权限不足（`chmod +x`），或用户无权访问目标文件/目录
- 环境差异：Cron 运行环境非常精简，缺少登录 shell 的环境变量；必要时显式 `SHELL`/`PATH`/`HOME`
- 表达式冲突：Quartz 需在“日/星期”之一使用 `?`；Linux 5 位不支持 `? L W #`
- 任务未被 crond 读取：确认 `crontab -l` 有条目，`crond` 正在运行
- 查看日志定位：`/var/log/cron`、`journalctl -u crond`、自定义日志重定向文件
