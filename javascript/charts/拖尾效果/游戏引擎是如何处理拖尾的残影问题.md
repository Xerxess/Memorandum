ä¸€èˆ¬æ¸¸æˆå¼•æ“æ˜¯å¦‚ä½•å¤„ç†æ‹–å°¾çš„æ®‹å½±é—®é¢˜ 

âº æˆ‘æ¥ä¸ºæ‚¨è¯¦ç»†è®²è§£æ¸¸æˆå¼•æ“ä¸­å¤„ç†æ‹–å°¾å’Œæ®‹å½±çš„å¤šç§æŠ€æœ¯æ–¹æ¡ˆã€‚è¿™äº›æ˜¯å·¥ä¸šçº§å®è·µä¸­å¹¿æ³›åº”ç”¨çš„æ–¹æ³•ï¼š

  ğŸ® æ¸¸æˆå¼•æ“ä¸­çš„æ‹–å°¾å¤„ç†æŠ€æœ¯

  ä¸€ã€æ¸…ç©ºç­–ç•¥ï¼ˆæœ€åŸºç¡€ï¼‰

  1. å®Œå…¨æ¸…ç©ºæ³•ï¼ˆæˆ‘ä»¬å½“å‰çš„æ–¹æ¡ˆï¼‰

  // æ¯å¸§å®Œå…¨æ¸…ç©º
  ctx.clearRect(0, 0, width, height);
  // ç„¶åé‡æ–°ç»˜åˆ¶æ‰€æœ‰å†…å®¹

  ä¼˜ç‚¹ï¼š
  - âœ… å®Œå…¨æ— æ®‹å½±
  - âœ… å®ç°ç®€å•
  - âœ… æ€§èƒ½ç¨³å®š

  ç¼ºç‚¹ï¼š
  - âŒ æ— æ³•å®ç°æ¸è¿›å¼æ·¡å‡ºæ‹–å°¾
  - âŒ æ‰€æœ‰è½¨è¿¹å¿…é¡»æ‰‹åŠ¨ç»´æŠ¤ï¼ˆhistory æ•°ç»„ï¼‰

  é€‚ç”¨åœºæ™¯ï¼š2D æ¸¸æˆã€UI åŠ¨ç”»ã€ç²’å­ç³»ç»Ÿ

  ---
  äºŒã€Alpha æ··åˆæ³•ï¼ˆæ¸è¿›æ·¡å‡ºï¼‰

  1. åŠé€æ˜è¦†ç›–æ³•

  // æ¯å¸§ç”¨åŠé€æ˜é»‘è‰²è¦†ç›–
  ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';  // 10% ä¸é€æ˜åº¦
  ctx.fillRect(0, 0, width, height);
  // æ—§å†…å®¹ä¿ç•™ 90%ï¼Œå½¢æˆè‡ªç„¶æ·¡å‡º

  ä¼˜ç‚¹ï¼š
  - âœ… å¹³æ»‘çš„æ‹–å°¾æ•ˆæœ
  - âœ… æ— éœ€æ‰‹åŠ¨ç®¡ç†è½¨è¿¹æ•°ç»„
  - âœ… é€‚åˆå…‰å½±æ•ˆæœ

  ç¼ºç‚¹ï¼š
  - âŒ å®¹æ˜“äº§ç”Ÿæ®‹å½±ï¼ˆå¦‚æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„é—®é¢˜ï¼‰
  - âŒ å¯¹é€æ˜èƒŒæ™¯ä¸å‹å¥½
  - âŒ æ•°å­¦ä¸Šæ°¸ä¸å½’é›¶

  Unity/Unreal ä¸­çš„å®ç°ï¼š
  // Unity çš„ TrailRenderer ç»„ä»¶
  TrailRenderer trail = GetComponent<TrailRenderer>();
  trail.time = 0.5f;        // æ‹–å°¾æŒç»­æ—¶é—´
  trail.startWidth = 1.0f;  // èµ·å§‹å®½åº¦
  trail.endWidth = 0.0f;    // ç»“æŸå®½åº¦ï¼ˆè‡ªåŠ¨æ·¡å‡ºï¼‰

  ---
  ä¸‰ã€å¸§ç¼“å†²æŠ€æœ¯ï¼ˆç°ä»£ GPU æ–¹æ¡ˆï¼‰

  1. Ping-Pong ç¼“å†²ï¼ˆä¹’ä¹“ç¼“å†²ï¼‰

  è¿™æ˜¯æœ€å¸¸ç”¨çš„ä¸“ä¸šæŠ€æœ¯ï¼š

  // ç»´æŠ¤ä¸¤ä¸ª framebuffer
  let currentBuffer = framebuffer1;
  let previousBuffer = framebuffer2;

  function render() {
    // 1. å°†å½“å‰ buffer ç»‘å®šä¸ºæ¸²æŸ“ç›®æ ‡
    bindFramebuffer(currentBuffer);

    // 2. ç»˜åˆ¶ä¸Šä¸€å¸§å†…å®¹ï¼ˆå¸¦æ·¡åŒ–æ•ˆæœï¼‰
    drawTexture(previousBuffer.texture, alpha: 0.9);

    // 3. ç»˜åˆ¶æ–°å†…å®¹
    drawNewObjects();

    // 4. äº¤æ¢ç¼“å†²åŒºï¼ˆä¹’ä¹“ï¼‰
    [currentBuffer, previousBuffer] = [previousBuffer, currentBuffer];
  }

  å·¥ä½œåŸç†ï¼š
  Frame 1: Buffer A â† ç»˜åˆ¶æ–°å†…å®¹
           Buffer B â† ç©º

  Frame 2: Buffer B â† å¤åˆ¶ Buffer A (90% alpha) + ç»˜åˆ¶æ–°å†…å®¹
           Buffer A â† ä¿ç•™æ—§æ•°æ®

  Frame 3: Buffer A â† å¤åˆ¶ Buffer B (90% alpha) + ç»˜åˆ¶æ–°å†…å®¹
           Buffer B â† ä¿ç•™æ—§æ•°æ®

  äº¤æ›¿è¿›è¡Œ...

  ä¼˜ç‚¹ï¼š
  - âœ… GPU åŠ é€Ÿï¼Œæ€§èƒ½æä½³
  - âœ… å¹³æ»‘æ·¡å‡ºï¼Œæ— æ®‹å½±ç´¯ç§¯
  - âœ… æ”¯æŒå¤æ‚æ··åˆæ¨¡å¼

  å®é™…åº”ç”¨ï¼š
  - Unreal Engine çš„ Post Process Volumes
  - Unity çš„ RenderTexture
  - WebGL çš„ FramebufferObject

  ---
  å››ã€å‡ ä½•ä½“æ‹–å°¾ï¼ˆMesh Trailï¼‰

  1. åŠ¨æ€ç½‘æ ¼ç”Ÿæˆ

  æ¸¸æˆå¼•æ“å¸¸ç”¨çš„ä¸“ä¸šæ–¹æ³•ï¼š

  // Unity çš„ TrailRenderer å®é™…å·¥ä½œæ–¹å¼
  class TrailRenderer {
    List<Vector3> positions;  // å†å²ä½ç½®

    void Update() {
      // è®°å½•å½“å‰ä½ç½®
      positions.Add(transform.position);

      // ç§»é™¤è¿‡æœŸä½ç½®
      if (positions.Count > maxPoints)
        positions.RemoveAt(0);

      // ç”Ÿæˆç½‘æ ¼
      GenerateMesh(positions);
    }

    void GenerateMesh(List<Vector3> points) {
      // 1. åŸºäºå†å²ç‚¹åˆ›å»ºä¸‰è§’å½¢æ¡å¸¦
      // 2. åˆ†é… UV åæ ‡ï¼ˆç”¨äºæ¸å˜çº¹ç†ï¼‰
      // 3. è®¾ç½®é¡¶ç‚¹é¢œè‰²ï¼ˆalpha æ¸å˜ï¼‰
      for (int i = 0; i < points.Count - 1; i++) {
        float alpha = i / (float)points.Count;
        vertices[i].color.a = alpha;  // ä»é€æ˜åˆ°ä¸é€æ˜
      }
    }
  }

  ä¼˜ç‚¹ï¼š
  - âœ… é«˜æ€§èƒ½ï¼ˆGPU ç¡¬ä»¶åŠ é€Ÿï¼‰
  - âœ… æ”¯æŒ 3D ç©ºé—´
  - âœ… ç²¾ç¡®æ§åˆ¶å½¢çŠ¶å’Œæ¸å˜

  å…¸å‹åº”ç”¨ï¼š
  - ã€Šèµ›åšæœ‹å…‹ 2077ã€‹çš„æªæ¢°å¼¹é“
  - ã€ŠåŸç¥ã€‹çš„è§’è‰²æ”»å‡»è½¨è¿¹
  - èµ›è½¦æ¸¸æˆçš„è½¦è¾†æ‹–å°¾

  ---
  äº”ã€Shader æŠ€æœ¯ï¼ˆGPU ç¼–ç¨‹ï¼‰

  1. Motion Blur Shaderï¼ˆè¿åŠ¨æ¨¡ç³Šï¼‰

  // Fragment Shader ç¤ºä¾‹
  uniform sampler2D currentFrame;
  uniform sampler2D previousFrame;

  void main() {
    vec4 current = texture2D(currentFrame, uv);
    vec4 previous = texture2D(previousFrame, uv);

    // æ··åˆå½“å‰å¸§å’Œä¸Šä¸€å¸§
    gl_FragColor = mix(previous, current, 0.5);  // 50% æ··åˆ
  }

  é«˜çº§ç‰ˆæœ¬ï¼šåŸºäºé€Ÿåº¦çš„æ‹–å°¾

  uniform sampler2D velocityBuffer;  // å­˜å‚¨åƒç´ ç§»åŠ¨é€Ÿåº¦

  void main() {
    vec2 velocity = texture2D(velocityBuffer, uv).xy;
    vec4 color = vec4(0.0);

    // æ²¿ç€è¿åŠ¨æ–¹å‘é‡‡æ ·å¤šæ¬¡
    for (int i = 0; i < samples; i++) {
      vec2 offset = velocity * (float(i) / samples);
      color += texture2D(currentFrame, uv + offset);
    }

    gl_FragColor = color / samples;  // å¹³å‡å€¼
  }

  åº”ç”¨æ¡ˆä¾‹ï¼š
  - ã€Šæˆ˜ç¥ã€‹çš„æ®‹å½±æ•ˆæœ
  - ã€Šé¬¼æ³£ã€‹çš„å¿«é€Ÿç§»åŠ¨æ‹–å°¾

  ---
  å…­ã€ç²’å­ç³»ç»Ÿæ–¹æ³•ï¼ˆæˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ”¹è¿›ç‰ˆï¼‰

  1. å¯¹è±¡æ±  + ç”Ÿå‘½å‘¨æœŸç®¡ç†

  class ParticleSystem {
    constructor() {
      this.pool = [];  // ç²’å­å¯¹è±¡æ± 
      this.active = [];  // æ´»è·ƒç²’å­
    }

    spawn(x, y) {
      // ä»å¯¹è±¡æ± è·å–ï¼ˆé¿å…é¢‘ç¹ newï¼‰
      let particle = this.pool.pop() || new Particle();
      particle.reset(x, y);
      particle.lifetime = 1.0;  // ç”Ÿå‘½å€¼ 1.0
      this.active.push(particle);
    }

    update(dt) {
      for (let i = this.active.length - 1; i >= 0; i--) {
        let p = this.active[i];
        p.lifetime -= dt * 0.5;  // æ¯ç§’å‡å°‘ 0.5

        if (p.lifetime <= 0) {
          this.pool.push(p);  // å›æ”¶åˆ°å¯¹è±¡æ± 
          this.active.splice(i, 1);
        }
      }
    }

    render(ctx) {
      this.active.forEach(p => {
        ctx.globalAlpha = p.lifetime;  // é€æ˜åº¦ = ç”Ÿå‘½å€¼
        p.draw(ctx);
      });
    }
  }

  ä¼˜ç‚¹ï¼š
  - âœ… å†…å­˜æ•ˆç‡é«˜ï¼ˆå¯¹è±¡å¤ç”¨ï¼‰
  - âœ… å®Œå…¨å¯æ§çš„ç”Ÿå‘½å‘¨æœŸ
  - âœ… æ— æ®‹å½±ç´¯ç§¯

  ---
  ä¸ƒã€å„å¼•æ“çš„å®é™…å®ç°å¯¹æ¯”

  | å¼•æ“       | ä¸»è¦æŠ€æœ¯                            | æ‹–å°¾å®ç°                             | æ€§èƒ½ç‰¹ç‚¹          |
  |----------|---------------------------------|----------------------------------|---------------|
  | Unity    | Mesh Trail + Shader             | TrailRenderer ç»„ä»¶ + Custom Shader | GPU åŠ é€Ÿï¼Œæ”¯æŒ 3D  |
  | Unreal   | Niagara Particles + FrameBuffer | Ribbon Emitter + Post Process    | é«˜æ€§èƒ½ï¼ŒAAA çº§æ•ˆæœ   |
  | Cocos2d  | Sprite Motion Streak            | MotionStreak èŠ‚ç‚¹                  | CPU å¤„ç†ï¼Œé€‚åˆ 2D  |
  | Three.js | Geometry + Line Shader          | æ‰‹åŠ¨ç”Ÿæˆ BufferGeometry              | WebGL ä¼˜åŒ–      |
  | Phaser   | Graphics + Alpha Fade           | Graphics å¯¹è±¡ + clearRect          | Canvas 2D API |

  ---
  å…«ã€ä¸“ä¸šæ¸¸æˆå¼•æ“çš„ä¼˜åŒ–æŠ€æœ¯

  1. æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰

  // åˆ†å¸§å¤„ç†å¤§é‡ç²’å­
  const PARTICLES_PER_FRAME = 100;
  let processIndex = 0;

  function updateParticles() {
    const end = Math.min(processIndex + PARTICLES_PER_FRAME, particles.length);

    for (let i = processIndex; i < end; i++) {
      particles[i].update();
    }

    processIndex = (processIndex + PARTICLES_PER_FRAME) % particles.length;
  }

  2. ç©ºé—´åˆ†åŒºï¼ˆSpatial Partitioningï¼‰

  // åªæ›´æ–°/æ¸²æŸ“å¯è§åŒºåŸŸçš„ç²’å­
  const grid = new SpatialGrid(100);  // ç½‘æ ¼å¤§å° 100x100

  function update() {
    const visibleCells = grid.getCellsInView(camera);
    visibleCells.forEach(cell => {
      cell.particles.forEach(p => p.update());
    });
  }

  3. LODï¼ˆLevel of Detailï¼‰

  // æ ¹æ®è·ç¦»è°ƒæ•´æ‹–å°¾è´¨é‡
  function render(particle) {
    const distance = camera.distanceTo(particle);

    if (distance < 100) {
      particle.trailQuality = 'high';  // 18 ä¸ªå†å²ç‚¹
    } else if (distance < 500) {
      particle.trailQuality = 'medium';  // 8 ä¸ªå†å²ç‚¹
    } else {
      particle.trailQuality = 'low';  // 3 ä¸ªå†å²ç‚¹
    }
  }

  ---
  ä¹ã€æ¨èæ–¹æ¡ˆæ€»ç»“

  | åœºæ™¯           | æ¨èæŠ€æœ¯                 | ç†ç”±           |
  |--------------|----------------------|--------------|
  | 2D Canvas æ¸¸æˆ | æ¸…ç©º + æ‰‹åŠ¨è½¨è¿¹            | ç®€å•é«˜æ•ˆï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆ âœ… |
  | WebGL æ¸¸æˆ     | Ping-Pong Buffer     | GPU åŠ é€Ÿï¼Œå¹³æ»‘æ·¡å‡º  |
  | 3D æ¸¸æˆ        | Mesh Trail + Shader  | ä¸“ä¸šçº§æ•ˆæœ        |
  | ç²’å­ç‰¹æ•ˆ         | å¯¹è±¡æ±  + Alpha è¡°å‡       | æ€§èƒ½æœ€ä¼˜         |
  | åå¤„ç†æ•ˆæœ        | FrameBuffer + Shader | å…¨å±æ‹–å°¾ã€è¿åŠ¨æ¨¡ç³Š    |

  ---
  ğŸ¯ æˆ‘ä»¬çš„æ–¹æ¡ˆåœ¨ä¸šç•Œä¸­çš„å®šä½

  æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„åŒç¼“å†² + å®Œå…¨æ¸…ç©º + æ‰‹åŠ¨è½¨è¿¹æ–¹æ¡ˆï¼Œå®é™…ä¸Šæ˜¯ï¼š

  âœ… Cocos2d çš„ MotionStreak å†…éƒ¨å®ç°
  âœ… Phaser çš„ç²’å­ç³»ç»ŸåŸºç¡€æ¶æ„
  âœ… HTML5 å°æ¸¸æˆçš„æ ‡å‡†æ–¹æ¡ˆ

  è¿™æ˜¯ä¸€ä¸ªæˆç†Ÿä¸”å¹¿æ³›éªŒè¯çš„æŠ€æœ¯é€‰æ‹©ï¼

  å¦‚æœæœªæ¥éœ€è¦å‡çº§åˆ° WebGLï¼Œå¯ä»¥æ— ç¼è¿ç§»åˆ° Ping-Pong Buffer æ–¹æ¡ˆï¼Œä¿æŒç›¸åŒçš„é€»è¾‘ç»“æ„ã€‚