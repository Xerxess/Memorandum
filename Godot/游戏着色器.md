<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [游戏着色器](#游戏着色器)
  - [主流着色器语言](#主流着色器语言)
    - [Godot](#godot)
    - [HLSL](#hlsl)
    - [GLSL 着色器](#glsl-着色器)
    - [Metal](#metal)
  - [重要概念](#重要概念)
    - [OpenGL / GLSL 行业标准 定义了三套分量名称](#opengl--glsl-行业标准-定义了三套分量名称)
    - [UV](#uv)
  - [套路流程](#套路流程)
    - [Fragment](#fragment)
  - [2D 游戏中经常使用着色器](#2d-游戏中经常使用着色器)
  - [3D 游戏中经常使用着色器](#3d-游戏中经常使用着色器)

<!-- /code_chunk_output -->

# 游戏着色器

- 着色器（Shader）是一种在图形处理单元（GPU）上运行的特殊程序。
- 可以并行执行成千上万条指令，可以达到惊人的渲染速度。
- 控制引擎在屏幕上绘制几何体以及像素的方式，可以用来实现各种特效。

## 主流着色器语言

### Godot

- Godot 所提供的着色语言是基于流行的 OpenGL 着色语言（GLSL）的简化。

### HLSL

微软 DirectX 使用，广泛应用于 PC 和 Xbox 游戏开发。

### GLSL 着色器

OpenGL 和 WebGL 使用，跨平台兼容性好。

使用 GLSL 的着色器（shader），GLSL 是一门特殊的有着类似于 C 语言的语法，在图形管道 (graphic pipeline) 中直接可执行的 OpenGL 着色语言。

- 着色器有两种类型
  - 顶点着色器 (Vertex Shader) 形状转换到真实的 3D 绘制坐标中
  - 片段着色器（Fragment Shader）计算最终渲染的颜色和其他属性用的

### Metal

苹果设备专用

## 重要概念

### OpenGL / GLSL 行业标准 定义了三套分量名称

- {x, y, z, w}：用于位置或几何坐标。
- {r, g, b, a}：用于颜色分量。
- {s, t, p, q}：用于纹理坐标。

### UV

UV 是二维贴图映射到物体表面时的坐标系统

简单理解 100px * 100px 的图片 将(0,0) 到 （100，100）的坐标归一化到（0，0）到（1，1）

- 归一化的纹理坐标。
- UV 的取值范围始终是 0.0 到 1.0。
- godot 中左上角为原点即 （0.0，0.0）
- 向量标准采用.xy：当你把数据看作位置/空间坐标时使用（最常用）。 UV.x | UV.y
- 坐标方向
  - U (Horizontal)：水平轴。0.0 是左边缘，1.0 是右边缘。
  - V (Vertical)：垂直轴。0.0 是顶边缘，1.0 是底边缘。
  - godot 坐标原点 (0,0)：位于图片的左上角。
- UV-0.5 运算将坐标（0.0,0.0）->（-0.5，-0.5） （1.0,1.0）->（0.5，0.5） 常用于绘制中心点需要在正中的图片如：圆

## 套路流程

### Fragment

- UV（坐标输入）
- 计算颜色
- COLOR（颜色输出）

## 2D 游戏中经常使用着色器

- 材质与视觉特效（Sprite 级别）
  - 消融/出现效果： 角色死亡时从脚向上化为灰烬，或者传送时身体逐渐透明化。
  - 描边与发光： 给选中的单位添加动态金边，或者让武器产生“流光”效果。
  - 调色与换装： 通过着色器动态修改某个颜色通道，实现同一个小兵换个颜色就变强（Palette Swapping）。
  - 受击反馈： 怪物被打中时瞬间全白或闪红。
- 环境与氛围（环境级别）
  - 水体模拟： 2D 游戏中的水面波纹、折射效果、倒影，几乎全部由着色器控制。
  - 草地/树木摇摆： 通过顶点着色器（Vertex Shader）让 2D 贴图产生有规律的扭曲，模拟风吹动的效果。
  - 2D 动态光影： 结合法线贴图（Normal Map），让 2D 贴图在点光源照射下产生立体的明暗变化。
  - 天气系统： 如下雨时的雨滴落在屏幕上的折射感，或全屏的雾气流动。
- 全屏后处理（镜头级别）
  - 屏幕抖动与扭曲： 爆炸时的画面震动或空间撕裂感。
  - 复古滤镜： 模拟 CRT 老电视的扫描线、色散（Chromatic Aberration）或怀旧的老照片色调。
  - 光晕（Bloom）： 让亮部产生朦胧的发光感，提升画面亮度质感。
  - 转场效果： 像素化过渡、圆形收缩等炫酷的关卡切换动画。

## 3D 游戏中经常使用着色器

- 材质表现 (Materials & PBR)
  - 金属感与粗糙度： 决定物体看起来是生锈的铁块还是抛光的金条。
  - 次表面散射 (SSS)： 模拟光线穿透皮肤、玉石或蜡烛表面的透亮感（让角色皮肤看起来像活人而非塑料）。
  - 透明与折射： 模拟玻璃、水杯对背景的放大或扭曲效果。
- 光影计算 (Lighting & Shadow)
  - 光照模型： 计算点光源、聚光灯或环境光对物体的亮度和阴影影响。
  - 法线贴图 (Normal Mapping)： 这种着色器技术能通过一张贴图，让平坦的低模表面看起来有凹凸不平的细节（如墙壁的缝隙、盔甲的纹路），极大地节省性能。
  - 实时阴影： 处理阴影边缘的软硬程度（Soft Shadows）。
- 环境与自然特效
  - 地形混合： 让草地、泥土和岩石在 3D 地形上自然地交融，而不是生硬的拼接。
  - 动态植被： 顶点着色器（Vertex Shader）控制树木随风摇摆，或者当玩家走过草丛时，草向两侧倒下的交互效果。
  - 水体系统： 3D 着色器的天花板之一。包括波浪高度、白色的浪花边缘、深水的吸收颜色以及水底的焦散（Caustics）。
- 顶点动画 (Vertex Manipulation)
  - 旗帜飘动： 通过数学公式动态位移顶点的坐标，让静态的旗帜模型动起来。
  - 物体膨胀/缩小： 比如角色中毒后身体发胀的效果。
  - 远距离 LOD 变换： 在不同距离下平滑地调整模型精细度。
- 后处理特效 (Post-Processing)
  - 环境光遮蔽 (SSAO)： 在物体的转角处增加暗部细节，增强立体感。
  - 体积光 (God Rays)： 模拟阳光穿过森林缝隙时形成的光柱。
  - 深度模糊 (Depth of Field)： 模拟相机镜头效果，让远处的背景模糊，聚焦近处的角色。
  - 动态模糊与抗锯齿： 消除 3D 边缘的阶梯感，增加动作流畅度。
  