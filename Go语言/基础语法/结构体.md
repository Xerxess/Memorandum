<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [结构体](#结构体)
  - [组合（Embedding）与“继承”](#组合embedding与继承)
  - [访问](#访问)
  - [结构体标签](#结构体标签)
    - [demo](#demo)

<!-- /code_chunk_output -->

# 结构体

- 结构体（Struct） 是将不同类型的数据组合在一起的自定义类型。它是 Go 实现面向对象特性的核心（Go 没有 class 关键字，结构体承担了类似角色）。
- 结构体是值类型

```go
type User struct {
    ID      int
    Name    string
    Email   string
    IsActive bool
}

// 接收非指针接收者方法
func (user User) setUserName(newName string) {
    user.Name = newName
}

// 指针接收者方法
func (u *User) SetName(newName string) {
    u.Name = newName
}

// 初始化
u1 := User{ID: 1, Name: "Alice"} // 部分初始化，其余为零值
u2 := User{2, "Bob", "bob@example.com", true} // 按顺序全量初始化

u1.setUserName("小明")
fmt.Println(u1.Name) // Alice
u1.SetName("小红")
fmt.Println(u1.Name) // 小红
```

## 组合（Embedding）与“继承”

```go
type Admin struct {
    User   // 匿名嵌入 User 结构体
    Level  int
}

// 创建带有字面量的结构体时，我们必须显式初始化嵌入；这里嵌入的类型用作字段名。
ad := Admin{
    User{}
}
ad.Name = "Boss" // 直接访问 User 的字段，类似继承的效果
```

## 访问

```go
// internal/user/user.go
package user

// 1. 定义数据结构 (公开)
type User struct {
 ID   int64
 Name string
 sex  string
}

// 2. 定义存储接口 (解耦关键)
type Repository interface {
 GetByID(id int64) (*User, error)
}

// 3. 定义业务逻辑
type Service struct {
 repo Repository
}

func NewService(r Repository) *Service {
 return &Service{repo: r}
}

func (user *User) setName(userName string) {
 user.Name = userName
}

func (user *User) SetName(userName string) {
 user.Name = userName
}

```

```go
package main

import (
 "example/hello/internal/user"
 "fmt"
)

type User2 struct {
 ID   int64
 Name string
 sex  string
}

func main() {
 // 初始化
 user := user.User{ID: 1, Name: "小明"}
 user2 := User2{ID: 1, Name: "小明"}
 fmt.Println(user.Name)
 fmt.Println(user.sex) // 不能访问 Err:user.sex undefined (cannot refer to unexported field sex)
 fmt.Println(user2.sex) // 当前包中可以访问
}
```

## 结构体标签

- 常用于 JSON 序列化 或数据库 ORM 映射。

```go
type Config struct {
    ServerName string `json:"server_name"` // 转换为 JSON 时显示为 server_name
    Port       int    `json:"port"`
}
```

### demo

```go
type Message struct {
  Name string
  Body string
  Time int64
 }
 m := Message{"Alice", "Hello", 1294706395881547000}
 b, err := json.Marshal(m)
 if err == nil {
  fmt.Println(string(b))
 }

 jsonString := []byte(`{"Name":"Alice","Body":"Hello","Time":1294706395881547000}`)

 var mm Message
 err1 := json.Unmarshal(jsonString, &mm)
 if err1 == nil {
  fmt.Println(mm.Name)
 }
```
