
# 反射

- Go 语言中非常核心且强大的 reflect（反射）包。
- 反射是 Go 语言实现“元编程”的基础，许多著名的框架（如 encoding/json, ORM, 依赖注入库）都严重依赖它。

## 概念

- reflect.Type：这是 Go 类型的接口表示。它告诉你变量是什么类型（如 int, struct User, []string）。
- reflect.Value：这是 Go 值的接口表示。它不仅包含类型信息，还包含了该变量持有的具体数据。

## Kind（种类）与 Type 的区别

- Type 是具体的类型，比如 MyStruct、*User。
- Kind 是类型的底层分类，比如 Struct、Ptr、Int、Slice。

## 结构体的反射

### JSON 序列化库的工作原理

- NumField()：返回结构体字段数量。
- Field(i int) / FieldByName(name string)：获取第 i 个字段或指定名字的字段（返回 StructField）。
- StructField 结构：包含了字段的 Name, Type, Tag (标签) 等信息。
- StructTag：这就是我们写 json:"name" 时用到的东西。

### 集合的反射

- 切片
  - Len(), Cap()。
  - Index(i)：获取第 i 个元素。
  - Append(x ...Value)：类似于 Go 的 append 函数，可以向切片追加元素。
  - SetLen(n)：修改切片长度（底层数组必须足够大）。
  - MakeSlice：动态创建一个切片。
- Map
  - MapKeys()：获取所有的 Key（返回 []Value）。
  - MapIndex(key)：根据 Key 获取 Value。
  - SetMapIndex(key, elem)：设置 Map 的键值对。
  - MapRange()：这是一个非常高效的迭代器。文档中专门列出了 MapIter 类型，用于遍历 Map。

## 函数与方法的调用

- MethodByName(name)：通过名字找到结构体的方法。
- Call(in []Value)：调用该方法。参数必须是 []reflect.Value，返回值也是 []reflect.Value。
- MakeFunc(typ Type, fn func(args []Value) (results []Value))：这是一个高级用法。它允许你用反射创建一个符合特定签名的函数。这使得 Go 可以实现类似于“代码生成”或“代理”的功能。
