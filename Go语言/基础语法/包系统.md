
# 包系统

- 包系统（Package System）是代码组织、访问控制和依赖管理的绝对核心。
- 包 是同一目录下多个 .go 源文件的集合
  - 作用：逻辑封装、代码复用、作用域隔离。

## 目录结构 = 包名

- 规则：同一目录下的所有 .go 文件，必须在第一行声明相同的 package name。
- 惯例：通常，目录名就是包名（例如目录叫 utils，包声明就是 package utils），但这不是强制的，只是极佳的工程惯例。

## 可见性规则：大写 vs 小写 (非常重要)

- Go 没有像 Java 那样的 public / private 关键字
- 导出 (大写) - Public
- 未导出 (小写) - Private

```go
package models

type User struct {
    Name string // 大写，外部可见 (user.Name)
    age  int    // 小写，外部不可见 (只能在 models 包内用 user.age)
}

func GetUserName() string { // 大写，外部可见
    return "Alice"
}

func resetAge() { // 小写，外部不可见
    // ...
}
```

## 包的引用

```go
import "fmt"         // 引入标准库
import "myproject/models" // 引入自定义包（路径通常是 go.mod 定义的模块路径）

// 多个引入 (分组)
import (
    "fmt"
    "net/http"
    "myproject/utils"
)

// 别名导入
import m "myproject/models" // 使用 m.User 而不是 models.User

// 点导入
// 省略包名前缀，直接使用包内的导出成员（像使用自己包内的东西一样）。
// 警告：极度不推荐在大型项目中使用，容易造成命名混淆。
import . "fmt" // 可以直接用 Println("Hello") 而不是 fmt.Println("Hello")
```

## 包的初始化顺序：init() 函数

- init() 函数是一个特殊的函数，用于包的初始化操作。它主要用于注册驱动、初始化环境变量或执行复杂的全局变量赋值。
- 每个包可以包含多个 init() 函数，它们在程序启动时自动执行。
- 全局变量初始化：先按照声明顺序初始化包级变量。
- init() 函数：如果同一个包有多个 init()，Go 无法保证它们之间的执行顺序（虽然通常是按文件字典序或声明顺序，但不要依赖这一点）。
- 包引用链：如果 main 包引用了 A 包，A 包引用了 B 包。初始化顺序：B (init) -> A (init) -> main (init) -> main 函数。

## 特殊目录：internal 目录 (Go 特有)

- Go 编译器对名为 internal 的目录有特殊的硬性限制
- 规则：如果一个包在 internal 目录下，或者位于 internal 的子目录下，那么只有 internal 的父级或祖先目录下的包才能引用它。
  - 目录 /a/b/c/internal/d/e/f 中的代码只能由根目录为 /a/b/c 的目录树中的代码导入。目录 /a/b/g 中的代码无法导入该目录树中的代码。
- 作用：强制隔离私有代码。即使你的代码是开源的，别人也无法引用 internal 里的包，因为它们不在你的项目层级路径下。

```text
github.com/user/project
├── main.go
├── internal/
│   └── db/
│       └── conn.go  (package db) // 能导入github.com/user/project/internal/db/internal
│       └── internal
│           └── conn2.go  (package db2)
└── utils/
    └── helper.go // 可以导入github.com/user/project/internal/db
    └── helper.go // 不能导入github.com/user/project/internal/db/internal
```
