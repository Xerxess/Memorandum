
# 模块系统

Go 语言模块系统是 Go 语言官方推出的依赖管理系统。

Go Module（模块） 是一个 Go 包的集合，通常对应一个代码仓库。

- 最外层目录：包含 go.mod 文件的目录。
- 唯一标识：每个模块都有一个模块路径（Module Path），通常也是导入路径，例如 github.com/gin-gonic/gin。
- 版本管理：模块引入了语义化版本控制，例如 v1.2.0、v2.0.0。
- 核心文件：go.mod 和 go.sum
  - go.mod（模块定义文件）
  - go.sum（校验和文件） 这个文件用于安全和可复现构建。注意：不要手动编辑 go.sum，也不要把它加入 .gitignore。

go.mod：

```go
module github.com/user/myproject  // 模块路径，也是其他项目引用时的前缀

go 1.21                           // 当前代码使用的 Go 版本

require (                         // 依赖列表
    github.com/gin-gonic/gin v1.9.1
    google.golang.org/grpc v1.58.3
)
```

## 常用命令

```cmd
# 初始化 创建 go.mod 文件
go mod init <模块名>

# 整理依赖（最常用）
# 增：扫描你的 .go 代码中的 import 语句，把缺失的依赖自动添加到 go.mod 中并下载
# 删：删除 go.mod 中有但代码中没用到的依赖。
go mod tidy

# 获取/更新依赖 手动添加或升级/降级依赖包。
go get <包路径>@<版本>
go get github.com/gin-gonic/gin：获取最新版本。
go get github.com/gin-gonic/gin@v1.8.0：获取指定版本。
go get -u ./...：更新当前模块的所有依赖（升级到最新的次版本或修订版）。

# 下载依赖
go mod download

# 生成 vendor 目录
go mod vendor
```

## replace 指令

```go
module github.com/user/project

go 1.21

require github.com/user/other-lib v1.0.0

// 这行表示：凡是用到 github.com/user/other-lib 的，
// 都用本地的 ../other-lib 目录代替，不再去网上下载。
replace github.com/user/other-lib => ../other-lib
```

## Go 代理设置

```cmd
# 直接从 github.com 等国外仓库拉取代码可能会很慢甚至失败
go env -w GOPROXY=https://goproxy.cn,direct

# 私有仓库配置
go env -w GOPRIVATE=git.company.com
```
