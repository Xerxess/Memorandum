# 子查询表达式

https://www.postgresql.org/docs/17/functions-subquery.html

## EXISTS (判断是否存在)

- 这是性能最常用的表达式，用于检查子查询是否返回至少一行。只要找到一行，它就会立即返回 TRUE，不会扫描整个结果集。

```sql
-- 查找有订单的用户（比使用 DISTINCT JOIN 性能更好）
SELECT username 
FROM users u
WHERE EXISTS (
    SELECT 1 FROM orders o WHERE o.user_id = u.id
);
```

## IN / NOT IN (集合匹配)

- 判断某个值是否在子查询返回的一列数据中

```sql
SELECT product_name 
FROM products 
WHERE category_id IN (
    SELECT id FROM categories WHERE name = '电子产品'
);
```

## ANY / SOME (满足其一)

- 将左侧的值与子查询返回的每一行进行比较，只要有一个满足操作符条件（如 =, >, <），即返回 TRUE。

```sql
-- 查找单价高于“电子产品”类别中“任意一个”商品的商品
SELECT name 
FROM products 
WHERE price > ANY (
    SELECT price FROM products WHERE category_id = 5
);
```

## ALL (满足全部)

```sql
-- 查找单价高于“电子产品”类别中“所有”商品的商品
SELECT name 
FROM products 
WHERE price > ALL (
    SELECT price FROM products WHERE category_id = 5
);
```