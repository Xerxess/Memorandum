# 二进制字符串函数和操作符

## 1. SQL标准二进制字符串函数和操作符

| 函数/操作符 | 描述 | 示例 |
|------------|------|------|
| `bytea \|\| bytea` → `bytea` | 连接两个二进制字符串 | `'\x123456'::bytea \|\| '\x789a00bcde'::bytea` → `\x123456789a00bcde` |
| `bit_length(bytea)` → `integer` | 返回二进制字符串中的位数（8倍于octet_length） | `bit_length('\x123456'::bytea)` → `24` |
| `btrim(bytes bytea, bytesremoved bytea)` → `bytea` | 从bytes的开头和结尾移除只包含bytesremoved中出现字节的最长字符串 | `btrim('\x1234567890'::bytea, '\x9012'::bytea)` → `\x345678` |
| `ltrim(bytes bytea, bytesremoved bytea)` → `bytea` | 从bytes的开头移除只包含bytesremoved中出现字节的最长字符串 | `ltrim('\x1234567890'::bytea, '\x9012'::bytea)` → `\x34567890` |
| `octet_length(bytea)` → `integer` | 返回二进制字符串中的字节数 | `octet_length('\x123456'::bytea)` → `3` |
| `overlay(bytes bytea PLACING newsubstring bytea FROM start integer [FOR count integer])` → `bytea` | 替换bytes中从第start个字节开始、延伸count字节的子字符串为newsubstring | `overlay('\x1234567890'::bytea placing '\002\003'::bytea from 2 for 3)` → `\x12020390` |
| `position(substring bytea IN bytes bytea)` → `integer` | 返回substring在bytes中的起始索引，如果不存在则返回0 | `position('\x5678'::bytea in '\x1234567890'::bytea)` → `3` |
| `rtrim(bytes bytea, bytesremoved bytea)` → `bytea` | 从bytes的末尾移除只包含bytesremoved中出现字节的最长字符串 | `rtrim('\x1234567890'::bytea, '\x9012'::bytea)` → `\x12345678` |
| `substring(bytes bytea [FROM start integer] [FOR count integer])` → `bytea` | 提取bytes中从第start个字节开始、count字节长度的子字符串 | `substring('\x1234567890'::bytea from 3 for 2)` → `\x5678` |
| `trim([LEADING\|TRAILING\|BOTH] bytesremoved bytea FROM bytes bytea)` → `bytea` | 从bytes的开头、末尾或两端（BOTH为默认）移除只包含bytesremoved中出现字节的最长字符串 | `trim('\x9012'::bytea from '\x1234567890'::bytea)` → `\x345678` |
| `trim([LEADING\|TRAILING\|BOTH] [FROM] bytes bytea, bytesremoved bytea)` → `bytea` | trim()的非标准语法 | `trim(both from '\x1234567890'::bytea, '\x9012'::bytea)` → `\x345678` |

## 2. 其他二进制字符串函数

| 函数 | 描述 | 示例 |
|------|------|------|
| `bit_count(bytes bytea)` → `bigint` | 返回二进制字符串中设置的位数（也称为"popcount"） | `bit_count('\x1234567890'::bytea)` → `15` |
| `get_bit(bytes bytea, n bigint)` → `integer` | 从二进制字符串中提取第n位 | `get_bit('\x1234567890'::bytea, 30)` → `1` |
| `get_byte(bytes bytea, n integer)` → `integer` | 从二进制字符串中提取第n个字节 | `get_byte('\x1234567890'::bytea, 4)` → `144` |
| `length(bytea)` → `integer` | 返回二进制字符串中的字节数 | `length('\x1234567890'::bytea)` → `5` |
| `length(bytes bytea, encoding name)` → `integer` | 返回二进制字符串中的字符数，假设它是给定编码的文本 | `length('jose'::bytea, 'UTF8')` → `4` |
| `md5(bytea)` → `text` | 计算二进制字符串的MD5哈希值，结果以十六进制表示 | `md5('Th\000omas'::bytea)` → `8ab2d3c9689aaf18​b4958c334c82d8b1` |
| `set_bit(bytes bytea, n bigint, newvalue integer)` → `bytea` | 将二进制字符串中的第n位设置为newvalue | `set_bit('\x1234567890'::bytea, 30, 0)` → `\x1234563890` |
| `set_byte(bytes bytea, n integer, newvalue integer)` → `bytea` | 将二进制字符串中的第n个字节设置为newvalue | `set_byte('\x1234567890'::bytea, 4, 64)` → `\x1234567840` |
| `sha224(bytea)` → `bytea` | 计算二进制字符串的SHA-224哈希值 | `sha224('abc'::bytea)` → `\x23097d223405d8228642a477bda2​55b32aadbce4bda0b3f7e36c9da7` |
| `sha256(bytea)` → `bytea` | 计算二进制字符串的SHA-256哈希值 | `sha256('abc'::bytea)` → `\xba7816bf8f01cfea414140de5dae2223​b00361a396177a9cb410ff61f20015ad` |
| `sha384(bytea)` → `bytea` | 计算二进制字符串的SHA-384哈希值 | `sha384('abc'::bytea)` → `\xcb00753f45a35e8bb5a03d699ac65007​272c32ab0eded1631a8b605a43ff5bed​8086072ba1e7cc2358baeca134c825a7` |
| `sha512(bytea)` → `bytea` | 计算二进制字符串的SHA-512哈希值 | `sha512('abc'::bytea)` → `\xddaf35a193617abacc417349ae204131​12e6fa4e89a97ea20a9eeee64b55d39a​2192992a274fc1a836ba3c23a3feebbd​454d4423643ce80e2a9ac94fa54ca49f` |
| `substr(bytes bytea, start integer [, count integer])` → `bytea` | 提取bytes中从第start个字节开始、count字节长度的子字符串 | `substr('\x1234567890'::bytea, 3, 2)` → `\x5678` |

### 位和字节编号说明

- `get_byte`和`set_byte`函数将二进制字符串的第一个字节编号为字节0
- `get_bit`和`set_bit`函数在每个字节内从右向左编号位
- 例如，位0是第一个字节的最低有效位，位15是第二个字节的最高有效位

### 哈希函数说明

由于历史原因，`md5`函数返回十六进制编码的text类型值，而SHA-2函数返回bytea类型。使用`encode`和`decode`函数在两者之间转换：

- `encode(sha256('abc'), 'hex')` 获取十六进制编码的文本表示
- `decode(md5('abc'), 'hex')` 获取bytea值

## 3. 文本/二进制字符串转换函数

| 函数 | 描述 | 示例 |
|------|------|------|
| `convert(bytes bytea, src_encoding name, dest_encoding name)` → `bytea` | 将表示src_encoding编码文本的二进制字符串转换为dest_encoding编码的二进制字符串 | `convert('text_in_utf8', 'UTF8', 'LATIN1')` → `\x746578745f696e5f75746638` |
| `convert_from(bytes bytea, src_encoding name)` → `text` | 将表示src_encoding编码文本的二进制字符串转换为数据库编码的text | `convert_from('text_in_utf8', 'UTF8')` → `text_in_utf8` |
| `convert_to(string text, dest_encoding name)` → `bytea` | 将text字符串（数据库编码）转换为dest_encoding编码的二进制字符串 | `convert_to('some_text', 'UTF8')` → `\x736f6d655f74657874` |
| `encode(bytes bytea, format text)` → `text` | 将二进制数据编码为文本表示；支持的格式：base64、escape、hex | `encode('123\000\001', 'base64')` → `MTIzAAE=` |
| `decode(string text, format text)` → `bytea` | 从文本表示解码二进制数据；支持的格式与encode相同 | `decode('MTIzAAE=', 'base64')` → `\x3132330001` |
